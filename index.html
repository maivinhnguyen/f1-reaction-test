<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>F1 Clutch Reaction Test</title>
    
    <meta name="description" content="Test your reaction time against the F1 start lights.">
    <meta property="og:title" content="F1 Clutch Reaction Test">
    <meta property="og:description" content="Test your reaction time against F1 lights. Can you beat 0.200s?">
    <meta property="og:url" content="https://maivinhnguyen.github.io/f1-reaction-test/">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#111111">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #111111;
            color: #ffffff;
            user-select: none;
            -webkit-user-select: none;
            overflow: hidden; 
            touch-action: none; 
            -webkit-touch-callout: none;
        }

        .light {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #2a2a2a;
            border: 4px solid #1a1a1a;
            transition: background-color 0.05s, box-shadow 0.05s;
        }

        @media (max-width: 640px) {
            .light {
                width: 40px;
                height: 40px;
                border-width: 3px;
            }
        }

        .light.active {
            background-color: #ff0000;
            box-shadow: 
                0 0 15px 2px rgba(255, 0, 0, 0.8), 
                0 0 40px 10px rgba(255, 0, 0, 0.4),
                inset 0 0 10px rgba(255, 200, 200, 0.5);
            border-color: #ff3333;
        }

        .gantry-bg {
            background: linear-gradient(to bottom, #222, #111);
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .clutch-indicator {
            transition: all 0.1s ease;
        }
        .clutch-active {
            transform: scale(0.96);
            opacity: 0.9;
            border-color: #ef4444 !important;
            color: #ef4444 !important;
            background-color: rgba(239, 68, 68, 0.1);
        }

        .timer-display {
            font-family: 'Orbitron', sans-serif;
            font-variant-numeric: tabular-nums;
        }
    </style>
</head>
<body class="h-screen w-full flex flex-col items-center justify-between py-8 relative cursor-pointer">

    <div class="absolute inset-0 z-0 opacity-5 pointer-events-none" 
         style="background-image: radial-gradient(#444 1px, transparent 1px); background-size: 20px 20px;">
    </div>

    <div class="z-10 w-full max-w-3xl flex flex-col items-center space-y-8 mt-4">
        <div class="flex flex-col items-center">
            <h1 class="text-xl text-gray-500 uppercase tracking-[0.3em] mb-4 font-bold">Formula 1 Reaction Test</h1>
            
            <div class="gantry-bg p-4 md:p-6 rounded-2xl flex gap-3 md:gap-6 relative">
                <div class="light" id="light-1"></div>
                <div class="light" id="light-2"></div>
                <div class="light" id="light-3"></div>
                <div class="light" id="light-4"></div>
                <div class="light" id="light-5"></div>
                
                <div class="absolute -top-4 left-10 right-10 h-4 border-l-2 border-r-2 border-t-2 border-gray-800 rounded-t-xl -z-10"></div>
            </div>
        </div>
    </div>

    <div class="z-10 flex flex-col items-center justify-center flex-grow space-y-6 text-center w-full px-4">
        
        <div id="status-text" class="text-xl md:text-3xl font-bold text-gray-400 tracking-widest transition-colors duration-200">
            HOLD TO ENGAGE CLUTCH
        </div>

        <div id="main-timer" class="timer-display text-6xl md:text-8xl font-black text-white opacity-50 transition-all duration-100">
            0.000
        </div>

        <div id="feedback" class="h-8 text-red-500 font-bold text-lg"></div>

    </div>

    <div class="z-10 w-full max-w-md px-6 pb-6">
        
        <div id="clutch-btn" class="clutch-indicator w-full border-2 border-gray-600 rounded-xl p-4 text-center mb-6 text-gray-500 font-bold select-none">
            <span class="text-sm md:text-base uppercase tracking-widest">Clutch Paddle Zone</span>
            <div class="text-xs text-gray-600 mt-1">Click & Hold anywhere / Touch & Hold</div>
        </div>

        <div class="border-t border-gray-800 pt-4">
            <div class="flex justify-between items-end text-gray-500 text-xs uppercase tracking-wider mb-2">
                <span>Recent Times</span>
                <div class="text-right">
                    <div class="text-[10px] text-gray-600">Personal Best</div>
                    <div id="best-time" class="text-yellow-500 font-bold text-sm font-mono">---</div>
                </div>
            </div>
            <div id="history-list" class="space-y-1 text-sm font-mono text-gray-400 h-28 overflow-hidden relative">
                <div class="text-gray-700 text-center italic mt-4">No data yet</div>
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        const STATE = {
            IDLE: 'IDLE',
            STAGING: 'STAGING',
            READY: 'READY',
            LIVE: 'LIVE',
            FINISHED: 'FINISHED',
            JUMP: 'JUMP'
        };

        let currentState = STATE.IDLE;
        let lightInterval = null;
        let randomTimeout = null;
        let startTime = 0;
        let reactionTimes = [];
        let bestTime = parseFloat(localStorage.getItem('f1_best_time')) || 99.999;

        // --- DOM Elements ---
        const lights = [1,2,3,4,5].map(i => document.getElementById(`light-${i}`));
        const statusText = document.getElementById('status-text');
        const mainTimer = document.getElementById('main-timer');
        const feedback = document.getElementById('feedback');
        const clutchBtn = document.getElementById('clutch-btn');
        const historyList = document.getElementById('history-list');
        const bestTimeDisplay = document.getElementById('best-time');

        // --- Audio System (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(freq = 440, type = 'sine', duration = 0.1, vol = 0.1) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        // --- Interaction Handlers ---

        function handleInputStart(e) {
            if (e.type === 'touchstart') e.preventDefault();
            if (e.button !== 0 && e.type === 'mousedown') return;

            // Ensure audio context is unlocked on first user interaction
            if (audioCtx.state === 'suspended') audioCtx.resume();

            clutchBtn.classList.add('clutch-active');

            if (currentState === STATE.IDLE || currentState === STATE.FINISHED || currentState === STATE.JUMP) {
                resetTest();
                startSequence();
            }
        }

        function handleInputEnd(e) {
            if (e.type === 'touchend') e.preventDefault();
            
            clutchBtn.classList.remove('clutch-active');

            if (currentState === STATE.STAGING || currentState === STATE.READY) {
                triggerJumpStart();
            } else if (currentState === STATE.LIVE) {
                finishTest();
            }
        }

        // --- Core Logic ---

        function updateBestTimeUI() {
            if (bestTime < 99) {
                bestTimeDisplay.textContent = bestTime.toFixed(3) + "s";
            } else {
                bestTimeDisplay.textContent = "---";
            }
        }
        updateBestTimeUI();

        function resetTest() {
            clearTimeout(lightInterval);
            clearTimeout(randomTimeout);
            
            lights.forEach(l => l.classList.remove('active'));
            mainTimer.textContent = "0.000";
            mainTimer.className = "timer-display text-6xl md:text-8xl font-black text-white opacity-50 transition-all duration-100";
            
            feedback.textContent = "";
            statusText.textContent = "CLUTCH ENGAGED";
            statusText.className = "text-xl md:text-3xl font-bold text-yellow-500 tracking-widest";
        }

        function startSequence() {
            currentState = STATE.STAGING;
            let currentLight = 0;
            
            setTimeout(() => {
                if(currentState !== STATE.STAGING) return;

                lightInterval = setInterval(() => {
                    if (currentLight < 5) {
                        lights[currentLight].classList.add('active');
                        playTone(600, 'square', 0.1, 0.05); 
                        currentLight++;
                    } else {
                        clearInterval(lightInterval);
                        currentState = STATE.READY;
                        const delay = Math.random() * 3000 + 200; 
                        randomTimeout = setTimeout(goLightsOut, delay);
                    }
                }, 1000);
            }, 500);
        }

        function goLightsOut() {
            if (currentState !== STATE.READY) return;

            lights.forEach(l => l.classList.remove('active'));
            playTone(880, 'square', 0.4, 0.1); 
            if (navigator.vibrate) navigator.vibrate(200);

            startTime = performance.now();
            currentState = STATE.LIVE;
            
            statusText.textContent = "GO!";
            statusText.className = "text-4xl md:text-6xl font-black text-green-500 tracking-widest scale-110 transform transition-transform";
            mainTimer.classList.remove('opacity-50');
            mainTimer.classList.add('opacity-100');
        }

        function triggerJumpStart() {
            currentState = STATE.JUMP;
            clearInterval(lightInterval);
            clearTimeout(randomTimeout);
            
            statusText.textContent = "JUMP START";
            statusText.className = "text-3xl font-bold text-red-600 animate-pulse";
            feedback.textContent = "Released too early!";
            lights.forEach(l => l.classList.add('active'));
            playTone(200, 'sawtooth', 0.4, 0.1);
        }

        function finishTest() {
            const endTime = performance.now();
            const rawTime = endTime - startTime;
            const formattedTime = (rawTime / 1000).toFixed(3);
            
            currentState = STATE.FINISHED;
            mainTimer.textContent = formattedTime;
            
            if (rawTime < 100) {
                statusText.textContent = "FALSE START";
                mainTimer.classList.add('text-red-500');
                feedback.textContent = "Reaction < 0.100s";
            } else {
                statusText.textContent = "FINISH";
                mainTimer.classList.remove('text-white');
                mainTimer.classList.add('text-green-400');
                
                let comment = "";
                if (rawTime < 200) comment = "F1 DRIVER LEVEL! ðŸ†";
                else if (rawTime < 250) comment = "Very Fast ðŸŽï¸";
                else if (rawTime < 300) comment = "Good Start";
                else if (rawTime < 400) comment = "Average";
                else comment = "Bogged Down ðŸ¢";
                
                feedback.textContent = comment;
                
                if (parseFloat(formattedTime) < bestTime) {
                    bestTime = parseFloat(formattedTime);
                    localStorage.setItem('f1_best_time', bestTime);
                    updateBestTimeUI();
                    feedback.textContent += " (PB!)";
                    if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
                }

                saveScore(formattedTime);
            }
        }

        function saveScore(time) {
            reactionTimes.unshift(parseFloat(time));
            if (reactionTimes.length > 5) reactionTimes.pop();
            
            historyList.innerHTML = reactionTimes.map((t, i) => `
                <div class="flex justify-between border-b border-gray-800 py-1">
                    <span class="text-gray-500">Run ${i+1}</span>
                    <span class="${t < 0.25 ? 'text-green-400' : 'text-white'}">${t.toFixed(3)}s</span>
                </div>
            `).join('');
        }

        // --- Event Listeners ---
        window.addEventListener('mousedown', handleInputStart);
        window.addEventListener('mouseup', handleInputEnd);
        
        window.addEventListener('touchstart', handleInputStart, {passive: false});
        window.addEventListener('touchend', handleInputEnd, {passive: false});

        window.addEventListener('contextmenu', e => e.preventDefault());

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !e.repeat) handleInputStart({ type: 'mousedown', button: 0 });
        });
        window.addEventListener('keyup', (e) => {
            if (e.code === 'Space') handleInputEnd({ type: 'mouseup' });
        });

    </script>
</body>
</html>
